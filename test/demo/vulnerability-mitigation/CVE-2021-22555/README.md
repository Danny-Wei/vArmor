# Demonstration Process

## 1. Set up a testing environment.
```
kubectl create ns demo
kubectl create -f test/demo/vulnerability-mitigation/CVE-2021-22555/deploy.yaml
```

## 2. Copy the exploit into the container of deployment.
```
pod_name=`kubectl get Pods -n demo | grep Running | head -n 1 | awk '{print $1}'`
kubectl cp -n demo test/demo/vulnerability-mitigation/CVE-2021-22555/exp $pod_name:/tmp/exp
```

## 3. Create an interactive shell in the container.
```
kubectl exec -n demo $pod_name -it -- /bin/sh
```

## 4. Check the container environment out.
```
id
cat /etc/hostname
ps ax
```

## 5. Execute the exploit, escape the container.
```
./tmp/exp
id
cat /etc/hostname
ps ax | grep kubelet
```

## 6. Create a vArmor Policy, then perform a rolling restart to enable the protection.
```
kubectl create -f test/demo/vulnerability-mitigation/CVE-2021-22555/policy.yaml
kubectl get VarmorPolicy -n demo
kubectl rollout restart deployment -n demo cve-2021-22555
```

## 7. Repeat steps 2 to 5

![image](https://github.com/bytedance/vArmor/blob/dev/test/demo/vulnerability-mitigation/CVE-2021-22555/demo.gif)
