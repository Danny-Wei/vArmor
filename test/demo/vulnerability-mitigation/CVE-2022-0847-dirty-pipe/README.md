# 演示流程

## 1. 创建工作负载
```
kubectl create ns test
kubectl create -f test/demo/kernel-exp/CVE-2022-0847-dirty-pipe/deploy.yaml
```

## 2. 登陆 Pod 所在节点，查看当前 runc sha256 hash，并备份 runc
```
sha256sum $(which runc)
cp $(which runc) runc.bak
```

## 3. 触发漏洞
```
pod_name=$(kubectl get Pods -n test -l app=cve-2022-0847 -o jsonpath='{.items[0].metadata.name}')
kubectl exec -n test $pod_name -it -- /bin/sh
```

## 4. 对比 runc 的 sha256hash，验证漏洞利用是否成功，然后恢复 runc
```
sha256sum $(which runc)
cp runc.bak $(which runc)
```

## 5. 为工作负载开启沙箱防护
```
kubectl create -f test/demo/kernel-exp/CVE-2022-0847-dirty-pipe/policy.yaml
kubectl get VarmorPolicy -n test
```

## 6. 重复步骤 2~5
