# Demonstration Process

## 1. Set up a testing environment.
```
kubectl create ns demo
kubectl create -f test/demo/vulnerability-mitigation/CVE-2022-0847-dirty-pipe/deploy.yaml
```

## 2. Log into the node where the Pod was scheduled, inspect the hash of runc and back up it.
```
sha256sum $(which runc)
cp $(which runc) runc.bak
```

## 3. Create an interactive shell and trigger the vulnerability in the container.
```
pod_name=$(kubectl get Pods -n demo -l app=cve-2022-0847 -o jsonpath='{.items[0].metadata.name}')
kubectl exec -n demo $pod_name -it -- /bin/sh
```

## 4. Compare the hash of runc to verify if the exploit was successful, then restore it.
```
sha256sum $(which runc)
cp runc.bak $(which runc)
```

## 5. Create a vArmor Policy, then tiger a rolling restart to enable the protection.
```
kubectl create -f test/demo/vulnerability-mitigation/CVE-2022-0847-dirty-pipe/policy.yaml
kubectl get VarmorPolicy -n demo
kubectl get Pods -n demo
```

## 6. Repeat steps 3

![image](CVE-2022-0847.gif)
